
<h1>Administrar Reservas (Admin)</h1>

<label>Email del usuario:</label>
<input type="email" [(ngModel)]="emailUsuario">
<button (click)="buscarUsuario()">Buscar</button>

<div *ngIf="cargando">Cargando datos...</div>
<div *ngIf="error" style="color: red;">{{ error }}</div>

<hr>

<div *ngIf="usuario">
  <h3>Datos del usuario</h3>
  <p><strong>ID:</strong> {{ usuario.id }}</p>
  <p><strong>Nombre:</strong> {{ usuario.nombre }}</p>
  <p><strong>Documento:</strong> {{ usuario.documento }}</p>

  <h3>Reservas</h3>
  <div *ngIf="reservas.length > 0">
    <div *ngFor="let r of reservas" style="border: 1px solid #ccc; padding: 10px; margin-bottom: 15px;">
      <p><strong>ID de reserva:</strong> {{ r.id }}</p>
      <p><strong>Check-in actual:</strong> {{ r.check_in_date }}</p>
      <p><strong>Check-out actual:</strong> {{ r.check_out_date }}</p>
      <p><strong>Status actual:</strong> {{ r.status }}</p>
      <p><strong>Comentarios:</strong> {{ r.comments || 'Sin comentarios' }}</p>

      <p><strong>Alojamiento:</strong> {{ r.accommodation?.accommodation_code }} ({{ r.accommodation?.type }})</p>
      <p><strong>Capacidad:</strong> {{ r.accommodation?.capacity }} personas</p>
      <p><strong>Precio por día:</strong> {{ r.accommodation?.price_per_day }}€</p>
      <h4>Acompañantes:</h4>
      <ul *ngIf="r.companions?.length > 0; else sinAcompanantes">
        <li *ngFor="let c of r.companions">
          {{ c.first_name }} {{ c.last_name_1 }} –
          {{ c.document_type }} {{ c.document_number || '(sin número)' }}
        </li>
      </ul>
      <ng-template #sinAcompanantes>
        <p>No hay acompañantes.</p>
      </ng-template>
  
      <button (click)="editarReserva = r.id">Modificar reserva</button>
  
      <div *ngIf="editarReserva === r.id" style="margin-top: 10px;">
        <label>Check-in:</label>
        <input type="date" [(ngModel)]="r.check_in_date" name="in_{{r.id}}">
        <br><br>
  
        <label>Check-out:</label>
        <input type="date" [(ngModel)]="r.check_out_date" name="out_{{r.id}}">
        <br><br>
  
        <label>Status:</label>
        <select [(ngModel)]="r.status" name="status_{{r.id}}">
          <option value="pending">Pending</option>
          <option value="confirmed">Confirmed</option>
          <option value="cancelled">Cancelled</option>
          <option value="checked_in">Checked In</option>
          <option value="checked_out">Checked Out</option>
        </select>
        <br><br>
  
        <label>Log (motivo del cambio):</label>
        <input type="text" [(ngModel)]="r.log_detail" name="log_{{r.id}}" required>
        <br><br>
  
        <button (click)="ModificarReserva(r)">Guardar cambios</button>
        <button (click)="editarReserva = null">Cancelar</button>
      </div>
    </div>
  </div>
  
  <p *ngIf="reservas.length === 0">Este usuario no tiene reservas.</p>
</div>
<hr>
<button (click)="volverAlPanelAdmin()">Volver al panel de administración</button>



